{% extends "base.html" %}
{% block title %}AI –¢—Ä–µ–π–¥–∏–Ω–≥ –ü–æ–º–æ—â–Ω–∏–∫{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ai_helper.css') }}">
<script defer src="{{ url_for('static', filename='js/ai_helper.js') }}"></script>
<style>
  /* –î–æ–±–∞–≤–∏–º —Å—Ç–∏–ª—å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
  .hidden {
    display: none !important;
  }
</style>
{% endblock %}

{% block content %}
<div id="ai-container">
  <div id="ai-header">
    <h2 style="margin:0; font-weight:600;">AI –¢—Ä–µ–π–¥–∏–Ω–≥ –ü–æ–º–æ—â–Ω–∏–∫</h2>
  </div>

  <!-- –§–æ—Ä–º–∞ –¥–ª—è API –∫–ª—é—á–∞ -->
  <div id="api-key-section">
    <h3 style="margin-top: 0;">üîë –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á</h3>
    <p style="margin-bottom: 15px;">
      –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI, –Ω—É–∂–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –æ—Ç <a href="https://openrouter.ai" target="_blank">OpenRouter API</a>
    </p>

    <div style="display: flex; gap: 10px;">
      <input type="password"
             id="api-key-input"
             placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –æ—Ç OpenRouter..."
             style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"
             autocomplete="off">
      <button id="save-key-btn"
              style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞ -->
    <div id="key-status" style="margin-top: 10px; display: none;"></div>
  </div>

  <!-- –ß–∞—Ç (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
  <div id="chat-section" class="hidden">
    <div id="chat-container" class="chatblock"></div>

    <div id="loading-indicator" style="display:none;">
      <em>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è<span id="dots">...</span></em>
    </div>

    <form id="ai-form" class="input-form" autocomplete="off">
      <textarea id="user_text" name="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." required></textarea>
      <button id="submit-btn" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  </div>
</div>

<!-- –î–æ–±–∞–≤–∏–º inline —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<script>
// –ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
  const savedKey = localStorage.getItem('openrouter_key');
  const apiKeySection = document.getElementById('api-key-section');
  const chatSection = document.getElementById('chat-section');

  if (savedKey) {
    // –ö–ª—é—á –µ—Å—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç, —Å–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
    if (apiKeySection) apiKeySection.classList.add('hidden');
    if (chatSection) chatSection.classList.remove('hidden');
  } else {
    // –ö–ª—é—á–∞ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É, —Å–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç
    if (apiKeySection) apiKeySection.classList.remove('hidden');
    if (chatSection) chatSection.classList.add('hidden');
  }
});
</script>
{% endblock %}