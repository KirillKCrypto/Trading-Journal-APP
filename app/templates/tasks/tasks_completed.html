{% extends "base.html" %}

{% block title %}–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks/tasks_active.css') }}">
<script defer src="{{ url_for('static', filename='js/tasks/tasks_active.js') }}"></script>
<style>
  .btn-danger {
    background-color: var(--theme-color);
  }
  .text-decoration-line-through {
    text-decoration: line-through;
    opacity: 0.7;
  }
  .completed-task {
    background-color: #d4edda !important;
    border-color: #c3e6cb !important;
  }
  body.dark-mode .completed-task {
    background-color: #155724 !important;
    border-color: #0f5132 !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="container container-tasks">
  <h2 class="text-body">‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>

  <a href="{{ url_for('tasks.task_list') }}" class="btn btn-outline-secondary mb-3">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –∑–∞–¥–∞—á–∞–º</a>

  <ul class="list-group" id="task-list">
  {% for task in tasks %}
    <li class="list-group-item d-flex justify-content-between align-items-center bg-body text-body task-item completed-task"
        data-id="{{ task.id }}"
        data-title="{{ task.title }}"
        data-description="{{ task.description }}"
        data-priority="{{ task.priority }}"
        data-completed="{{ '–î–∞' if task.completed else '–ù–µ—Ç' }}"
        data-created="{{ task.created_at.strftime('%Y-%m-%d %H:%M:%S') }}">

      <div class="flex-grow-1">
        <form action="{{ url_for('tasks.complete_task', task_id=task.id) }}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-sm btn-outline-secondary">‚úÖ</button>
        </form>
        <strong class="ms-2 text-decoration-line-through">{{ task.title }}</strong>
        {% if task.description and task.description|length <= 50 %}
          <p class="mb-0 small text-muted">{{ task.description }}</p>
        {% endif %}
        <p class="mb-0 text-muted">Priority: {{ task.priority }}</p>
      </div>

      <form action="{{ url_for('tasks.delete_task', task_id=task.id) }}" method="post" class="delete-form ms-2">
        <button type="submit" class="btn btn-sm btn-danger">
          –£–¥–∞–ª–∏—Ç—å
        </button>
      </form>
    </li>
  {% else %}
    <li class="list-group-item text-muted bg-body text-body">–ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.</li>
  {% endfor %}
  </ul>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div class="modal fade modal-dark-theme" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-modal="true" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-dark-theme">
      <div class="modal-header border-secondary-subtle">
        <h5 class="modal-title" id="taskModalLabel">üìã –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> <span id="modalTitle"></span></p>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="modalDescription"></span></p>
        <p><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> <span id="modalPriority"></span></p>
        <p><strong>–í—ã–ø–æ–ª–Ω–µ–Ω–∞:</strong> <span id="modalCompleted"></span></p>
        <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> <span id="modalCreated"></span></p>
      </div>
      <div class="modal-footer border-secondary-subtle">
        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content modal-dark-theme">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmModalLabel">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}